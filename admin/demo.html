<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的简单博客</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/supabase/1.35.7/supabase.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .blog-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .blog-form h2 {
            margin-bottom: 20px;
            color: #764ba2;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            cursor: pointer;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .posts-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .posts-section h2 {
            margin-bottom: 25px;
            color: #764ba2;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .post {
            border-bottom: 1px solid #eee;
            padding: 20px 0;
            transition: all 0.3s ease;
        }
        
        .post:last-child {
            border-bottom: none;
        }
        
        .post:hover {
            transform: translateX(10px);
            background: #f8f9fa;
            margin: 0 -20px;
            padding: 20px;
            border-radius: 10px;
        }
        
        .post h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1.3rem;
        }
        
        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .post-content {
            color: #555;
            line-height: 1.7;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #c33;
        }
        
        .success {
            background: #efe;
            color: #363;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #363;
        }
        
        .config-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            color: white;
        }
        
        .config-section h3 {
            margin-bottom: 15px;
        }
        
        .config-input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
        }

        function displayPosts(posts) {
            const postsHTML = posts.map(post => `
                <div class="post">
                    <h3>${escapeHtml(post.title)}</h3>
                    <div class="post-meta">
                        <span style="background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">
                            ${typeNames[post.type] || post.type || '未分类'}
                        </span>
                        <span style="background: #764ba2; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">
                            ${languageNames[post.language] || post.language || '未知语言'}
                        </span>
                        <br style="margin-bottom: 8px;">
                        作者：${escapeHtml(post.author)} | 
                        发布时间：${new Date(post.created_at).toLocaleString('zh-CN')}
                    </div>
                    <div class="post-content">${escapeHtml(post.content)}</div>
                </div>
            `).join('');

            document.getElementById('posts').innerHTML = postsHTML;
        }

        function filterPosts() {
            const typeFilter = document.getElementById('filterType').value;
            const languageFilter = document.getElementById('filterLanguage').value;

            let filteredPosts = allPosts;

            if (typeFilter) {
                filteredPosts = filteredPosts.filter(post => post.type === typeFilter);
            }

            if (languageFilter) {
                filteredPosts = filteredPosts.filter(post => post.language === languageFilter);
            }

            displayPosts(filteredPosts);
        }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .blog-form,
            .posts-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>我的简单博客</h1>
            <p>基于Supabase的轻量级博客系统</p>
        </div>

        <div class="config-section">
            <h3>Supabase配置</h3>
            <input type="text" id="supabaseUrl" class="config-input" placeholder="输入Supabase项目URL">
            <input type="text" id="supabaseKey" class="config-input" placeholder="输入Supabase API密钥">
            <button class="btn" onclick="initializeSupabase()">连接数据库</button>
        </div>

        <div class="blog-form">
            <h2>发布新文章</h2>
            <div id="message"></div>
            <form id="postForm">
                <div class="form-group">
                    <label for="title">文章标题</label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="author">作者</label>
                    <input type="text" id="author" name="author" required>
                </div>
                <div class="form-group">
                    <label for="type">文章分类</label>
                    <select id="type" name="type" required>
                        <option value="">请选择分类</option>
                        <option value="article">技术文章</option>
                        <option value="tutorial">教程指南</option>
                        <option value="review">产品评测</option>
                        <option value="news">新闻资讯</option>
                        <option value="thoughts">个人思考</option>
                        <option value="project">项目分享</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="language">语言</label>
                    <select id="language" name="language" required>
                        <option value="">请选择语言</option>
                        <option value="zh-CN">简体中文</option>
                        <option value="zh-TW">繁體中文</option>
                        <option value="en-US">English</option>
                        <option value="ja-JP">日本語</option>
                        <option value="ko-KR">한국어</option>
                        <option value="es-ES">Español</option>
                        <option value="fr-FR">Français</option>
                        <option value="de-DE">Deutsch</option>
                        <option value="ru-RU">Русский</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="content">文章内容</label>
                    <textarea id="content" name="content" required></textarea>
                </div>
                <button type="submit" class="btn" id="submitBtn">发布文章</button>
            </form>
        </div>

        <div class="posts-section">
            <h2>最新文章</h2>
            <div class="filter-section" style="margin-bottom: 25px;">
                <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                    <div>
                        <label for="filterType" style="margin-right: 8px; font-weight: 600;">分类筛选：</label>
                        <select id="filterType" onchange="filterPosts()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">全部分类</option>
                            <option value="article">技术文章</option>
                            <option value="tutorial">教程指南</option>
                            <option value="review">产品评测</option>
                            <option value="news">新闻资讯</option>
                            <option value="thoughts">个人思考</option>
                            <option value="project">项目分享</option>
                            <option value="other">其他</option>
                        </select>
                    </div>
                    <div>
                        <label for="filterLanguage" style="margin-right: 8px; font-weight: 600;">语言筛选：</label>
                        <select id="filterLanguage" onchange="filterPosts()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">全部语言</option>
                            <option value="zh-CN">简体中文</option>
                            <option value="zh-TW">繁體中文</option>
                            <option value="en-US">English</option>
                            <option value="ja-JP">日本語</option>
                            <option value="ko-KR">한국어</option>
                            <option value="es-ES">Español</option>
                            <option value="fr-FR">Français</option>
                            <option value="de-DE">Deutsch</option>
                            <option value="ru-RU">Русский</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="posts">
                <div class="loading">请先配置Supabase连接...</div>
            </div>
        </div>
    </div>

    <script>
        let supabaseClient = null;
        let allPosts = []; // 存储所有文章用于筛选

        // 分类和语言的显示名称映射
        const typeNames = {
            'article': '技术文章',
            'tutorial': '教程指南',
            'review': '产品评测',
            'news': '新闻资讯',
            'thoughts': '个人思考',
            'project': '项目分享',
            'other': '其他'
        };

        const languageNames = {
            'zh-CN': '简体中文',
            'zh-TW': '繁體中文',
            'en-US': 'English',
            'ja-JP': '日本語'
        };

        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 3000);
        }

        function initializeSupabase() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();

            if (!url || !key) {
                showMessage('请输入有效的Supabase URL和API密钥', 'error');
                return;
            }

            try {
                supabaseClient = supabase.createClient(url, key);
                showMessage('Supabase连接成功！');
                loadPosts();
                
                // 创建表格（如果不存在）
                createTable();
            } catch (error) {
                console.error('Supabase连接错误:', error);
                showMessage('Supabase连接失败，请检查配置', 'error');
            }
        }

        async function createTable() {
            if (!supabaseClient) return;

            try {
                // 尝试查询表格，如果失败说明表格不存在
                const { data, error } = await supabaseClient
                    .from('posts')
                    .select('count', { count: 'exact', head: true });

                if (error && error.code === 'PGRST116') {
                    showMessage('请在Supabase中创建posts表格，包含字段：id, title, author, content, created_at', 'error');
                }
            } catch (err) {
                console.error('表格检查错误:', err);
            }
        }

        async function loadPosts() {
            if (!supabaseClient) {
                document.getElementById('posts').innerHTML = '<div class="loading">请先配置Supabase连接...</div>';
                return;
            }

            document.getElementById('posts').innerHTML = '<div class="loading">加载中...</div>';

            try {
                const { data: posts, error } = await supabaseClient
                    .from('posts')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) {
                    console.error('加载文章错误:', error);
                    document.getElementById('posts').innerHTML = `
                        <div class="error">
                            加载文章失败: ${error.message}
                            <br><br>
                            <strong>如果是新项目，请先在Supabase中创建posts表格：</strong>
                            <br>
                            CREATE TABLE posts (<br>
                            &nbsp;&nbsp;id SERIAL PRIMARY KEY,<br>
                            &nbsp;&nbsp;title TEXT NOT NULL,<br>
                            &nbsp;&nbsp;author TEXT NOT NULL,<br>
                            &nbsp;&nbsp;content TEXT NOT NULL,<br>
                            &nbsp;&nbsp;type TEXT DEFAULT 'article',<br>
                            &nbsp;&nbsp;language TEXT DEFAULT 'zh-CN',<br>
                            &nbsp;&nbsp;created_at TIMESTAMP DEFAULT NOW()<br>
                            );
                        </div>
                    `;
                    return;
                }

                if (!posts || posts.length === 0) {
                    document.getElementById('posts').innerHTML = '<div class="loading">暂无文章，快来发布第一篇吧！</div>';
                    allPosts = [];
                    return;
                }

                allPosts = posts; // 保存所有文章
                displayPosts(posts);

            } catch (error) {
                console.error('加载文章错误:', error);
                document.getElementById('posts').innerHTML = '<div class="error">加载文章时发生错误</div>';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!supabaseClient) {
                showMessage('请先配置Supabase连接', 'error');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = '发布中...';

            const formData = new FormData(e.target);
            const postData = {
                title: formData.get('title'),
                author: formData.get('author'),
                content: formData.get('content'),
                type: formData.get('type'),
                language: formData.get('language')
            };

            try {
                const { data, error } = await supabaseClient
                    .from('posts')
                    .insert([postData]);

                if (error) {
                    console.error('发布错误:', error);
                    showMessage(`发布失败: ${error.message}`, 'error');
                } else {
                    showMessage('文章发布成功！');
                    e.target.reset();
                    loadPosts();
                }

            } catch (error) {
                console.error('发布错误:', error);
                showMessage('发布时发生错误', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });

        // 页面加载时尝试加载文章
        window.addEventListener('load', () => {
            loadPosts();
        });
    </script>
</body>
</html>